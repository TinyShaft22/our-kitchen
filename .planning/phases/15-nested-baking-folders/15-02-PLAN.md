---
phase: 15-nested-baking-folders
plan: 02
type: execute
---

<objective>
Add nested folder rendering to the Baking section in MealLibrary.

Purpose: Display baking recipes in a hierarchical folder structure with expand/collapse at each level.
Output: Updated MealLibrary.tsx with recursive NestedFolderSection component for Baking, Manage Folders button.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-phase.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/15-nested-baking-folders/15-01-SUMMARY.md
@src/pages/MealLibrary.tsx
@src/utils/subcategoryUtils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add NestedFolderSection component to MealLibrary</name>
  <files>src/pages/MealLibrary.tsx</files>
  <action>
Add new recursive component for nested folder rendering (Baking section only):

```typescript
interface NestedFolderSectionProps {
  node: FolderTreeNode;
  depth: number;
  expandedPaths: Set<string>;
  onToggle: (path: string) => void;
  onEdit: (meal: Meal) => void;
  onDelete: (meal: Meal) => void;
}
```

Behavior:
- Render folder header with icon (üìÅ/üìÇ), name, totalMealCount badge
- Indentation: depth * 16px margin-left
- Expand/collapse toggle with rotation animation (existing pattern)
- Recursively render child folders first, then meals at this level
- Root node (empty name) renders children directly without header

Keep existing SubcategorySection for Main Dishes (unchanged).
Import buildFolderTree from subcategoryUtils.ts.
  </action>
  <verify>Baking section shows nested folders when meals have path-based subcategories</verify>
  <done>NestedFolderSection renders recursively, folders expand/collapse independently</done>
</task>

<task type="auto">
  <name>Task 2: Add expansion state and Manage Folders button</name>
  <files>src/pages/MealLibrary.tsx</files>
  <action>
1. Add state for baking folder expansion:
   `const [expandedBakingPaths, setExpandedBakingPaths] = useState<Set<string>>(new Set());`

2. Add toggle function:
   `const toggleBakingPath = (path: string) => { ... }`

3. Build folder tree in useMemo:
   `const bakingFolderTree = useMemo(() => buildFolderTree(bakingRecipes), [bakingRecipes]);`

4. Extract all baking paths for modals:
   `const existingBakingPaths = useMemo(() => getAllFolderPaths(bakingRecipes), [bakingRecipes]);`

5. Add "Manage Folders" button to Baking section header (next to expand toggle):
   - Small button with folder icon
   - Opens FolderManagerModal
   - Add state: `const [isFolderManagerOpen, setIsFolderManagerOpen] = useState(false);`

6. Replace bakingBySubcategory grouping with NestedFolderSection using bakingFolderTree.

Keep Main Dishes section unchanged (flat SubcategorySection).
  </action>
  <verify>Baking section has Manage Folders button, nested folders expand/collapse correctly</verify>
  <done>Expansion state works at all nesting levels, Manage Folders modal accessible</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Nested folder display in Baking section with Manage Folders button</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:5173/meals
    3. Check Baking section has "Manage Folders" button in header
    4. Click Manage Folders - modal should show folder tree
    5. Create a test folder: "TestFolder"
    6. Create a subfolder: "TestFolder/SubTest"
    7. Verify folders show with proper indentation
    8. Verify expand/collapse works at each level
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Baking section shows nested folders with indentation
- [ ] Main Dishes section unchanged (flat folders)
- [ ] Manage Folders button opens FolderManagerModal
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Nested folders render correctly with expand/collapse
- Main Dishes section unaffected
</success_criteria>

<output>
After completion, create `.planning/phases/15-nested-baking-folders/15-02-SUMMARY.md`
</output>
