---
phase: 15-nested-baking-folders
plan: 03
type: execute
---

<objective>
Create step-by-step folder picker for Add/Edit meal modals when adding baking recipes.

Purpose: Allow users to select or create nested folders while adding/editing baking recipes.
Output: NestedFolderPicker.tsx component, updated AddMealModal.tsx and EditMealModal.tsx.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-phase.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/15-nested-baking-folders/15-02-SUMMARY.md
@src/components/meals/AddMealModal.tsx
@src/components/meals/EditMealModal.tsx
@src/pages/MealLibrary.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create NestedFolderPicker component</name>
  <files>src/components/meals/NestedFolderPicker.tsx</files>
  <action>
Create reusable folder picker with step-by-step creation:

Props:
```typescript
interface NestedFolderPickerProps {
  value: string;
  onChange: (path: string) => void;
  existingPaths: string[];
  isBaking: boolean;
}
```

Behavior when isBaking=false (Main Dishes):
- Simple dropdown of existing subcategories (existing behavior)
- "+ New" button for text input

Behavior when isBaking=true:
- Dropdown showing all paths with visual indentation (2 spaces per level)
- "+ New Folder" button opens step-by-step creation:

  Step 1: "Select parent folder" dropdown
  - Options: "Root (top level)" + all existing paths

  Step 2: "Enter folder name" text input

  Preview: Show full path that will be created (e.g., "Broma / Cookies / Holiday")

  Buttons: [Cancel] [Create & Select]

- On "Create & Select": build path (parent + "/" + name), call onChange(newPath)

Styling: Match existing modal form patterns (h-11 inputs, rounded-soft, border-charcoal/20).
  </action>
  <verify>Component compiles, handles both baking and non-baking modes</verify>
  <done>NestedFolderPicker shows flat dropdown for Main Dishes, step-by-step for Baking</done>
</task>

<task type="auto">
  <name>Task 2: Integrate NestedFolderPicker into AddMealModal</name>
  <files>src/components/meals/AddMealModal.tsx</files>
  <action>
1. Add new prop: `existingBakingPaths?: string[]`

2. Import NestedFolderPicker component

3. Replace existing subcategory selection UI with NestedFolderPicker:
   - Remove: isCreatingNewSubcategory, newSubcategoryName states
   - Remove: existing subcategory selection JSX (lines ~304-353)
   - Add: `<NestedFolderPicker value={subcategory} onChange={setSubcategory} existingPaths={isBaking ? existingBakingPaths : existingSubcategories} isBaking={isBaking} />`

4. Update subcategory handling in handleSave:
   - Remove: finalSubcategory logic for new subcategory
   - Simplify: just use subcategory state directly (NestedFolderPicker handles creation)

5. Keep other form fields unchanged.
  </action>
  <verify>AddMealModal shows correct folder picker based on isBaking toggle</verify>
  <done>Baking recipes show step-by-step folder creation, Main Dishes show flat dropdown</done>
</task>

<task type="auto">
  <name>Task 3: Integrate NestedFolderPicker into EditMealModal</name>
  <files>src/components/meals/EditMealModal.tsx</files>
  <action>
Apply same changes as AddMealModal:

1. Add new prop: `existingBakingPaths?: string[]`

2. Import NestedFolderPicker

3. Replace subcategory selection with NestedFolderPicker (same pattern as AddMealModal)

4. Update MealLibrary.tsx to pass existingBakingPaths to EditMealModal:
   - In EditMealModal usage, add: `existingBakingPaths={existingBakingPaths}`
  </action>
  <verify>EditMealModal shows correct folder picker based on meal's isBaking state</verify>
  <done>Edit modal matches Add modal behavior for folder selection</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Step-by-step folder picker in Add/Edit meal modals</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:5173/meals
    3. Click + to add a new meal
    4. Toggle "Baking Recipe" ON
    5. In Folder section, click "+ New Folder"
    6. Verify step-by-step UI appears:
       - Step 1: Parent folder dropdown (Root + existing folders)
       - Step 2: New folder name input
       - Preview of full path
    7. Create folder "Broma", then another "Broma/Cookies"
    8. Add a test baking recipe to "Broma/Cookies"
    9. Verify it appears nested in the Baking section
    10. Edit the recipe, confirm folder picker shows correctly
    11. Toggle "Baking Recipe" OFF, confirm flat dropdown returns
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Add modal: Baking shows step-by-step, Main Dishes shows flat dropdown
- [ ] Edit modal: Same behavior as Add modal
- [ ] New nested folders appear correctly in Baking section
- [ ] Existing flat subcategories still work for Main Dishes
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Step-by-step folder creation works seamlessly
- No regressions in Main Dishes folder functionality
- Phase 15 complete
</success_criteria>

<output>
After completion, create `.planning/phases/15-nested-baking-folders/15-03-SUMMARY.md`
</output>
