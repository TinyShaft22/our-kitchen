---
phase: 15-nested-baking-folders
plan: 01
type: execute
---

<objective>
Create utility functions for nested folder operations and the FolderManagerModal component.

Purpose: Establish the foundation for nested folder support - path parsing utilities and a dedicated UI for managing baking folders.
Output: subcategoryUtils.ts with tree-building functions, FolderManagerModal.tsx for folder organization.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-phase.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/types/index.ts
@src/pages/MealLibrary.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create subcategory utility functions</name>
  <files>src/utils/subcategoryUtils.ts</files>
  <action>
Create new file with utilities for nested folder operations:

1. `FolderTreeNode` interface: { name, fullPath, children: Map, meals: Meal[], totalMealCount }
2. `buildFolderTree(meals: Meal[])`: Build tree from flat meal list by parsing "/" delimited paths
3. `getAllFolderPaths(meals: Meal[])`: Return sorted array of all unique folder paths (including intermediate)
4. `getParentPath(path: string)`: Return parent path (e.g., "Broma/Cookies" -> "Broma")
5. `getLeafName(path: string)`: Return last segment (e.g., "Broma/Cookies" -> "Cookies")

Path format: Use "/" as delimiter (e.g., "Broma/Cookies/Holiday").
Handle empty/undefined subcategory as root level.
Sort children alphabetically within tree nodes.
  </action>
  <verify>TypeScript compiles without errors: `npm run build`</verify>
  <done>All utility functions exported, types correct, build passes</done>
</task>

<task type="auto">
  <name>Task 2: Create FolderManagerModal component</name>
  <files>src/components/meals/FolderManagerModal.tsx</files>
  <action>
Create modal for managing baking folder structure:

Props: { isOpen, onClose, existingPaths: string[], onCreateFolder: (path: string) => void }

UI Structure:
1. Modal header: "Manage Baking Folders" with close button
2. Tree view showing existing folders with indentation (16px per level)
3. Each folder row shows: folder icon, name, "+" button to add subfolder
4. "Add Root Folder" button at bottom for top-level folders
5. When "+" clicked: inline text input appears below with Save/Cancel

Styling: Match existing modal patterns (bg-cream, rounded-softer, shadow-lg).
Use folder icons: üìÅ collapsed, üìÇ expanded.
  </action>
  <verify>Component renders without errors in dev mode</verify>
  <done>FolderManagerModal displays folder tree, can create new folders at any level</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] subcategoryUtils.ts exports all 5 functions
- [ ] FolderManagerModal renders in isolation (can test by temporarily importing in a page)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Utility functions handle edge cases (empty paths, single segment, deep nesting)
</success_criteria>

<output>
After completion, create `.planning/phases/15-nested-baking-folders/15-01-SUMMARY.md`
</output>
