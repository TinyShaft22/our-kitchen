---
phase: 22-recipe-image-upload
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/update-recipe-images.ts
autonomous: true

must_haves:
  truths:
    - "All 21 muffin recipes have images displayed"
    - "All 21 brownie recipes have images displayed"
    - "Images load from Broma Bakery URLs"
    - "Images display as thumbnails on recipe cards"
  artifacts:
    - path: "Firestore meals collection"
      provides: "imageUrl field populated with Broma URLs for 42 recipes"
  key_links:
    - from: "Recipe card component"
      to: "Broma Bakery image URL"
      via: "imageUrl field in meal document"
      pattern: "imageUrl.*bromabakery.com"
---

<objective>
Set Broma Bakery image URLs directly on muffin and brownie recipes in Firestore.

Purpose: Complete v1.3 Broma Bakery Import milestone by adding recipe images to the 42 imported muffin and brownie recipes using external URLs (no upload needed).

Output: All 42 recipes (21 muffins + 21 brownies) have imageUrl fields pointing to Broma Bakery, images display in the app.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-muffins-batch/muffins-images.json
@.planning/phases/20-brownies-batch/brownies-images.json
@src/components/meals/MealCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Firestore Update Script</name>
  <files>scripts/update-recipe-images.ts</files>
  <action>
Create a TypeScript script that:

1. Reads the image mapping from JSON files:
   - `.planning/phases/19-muffins-batch/muffins-images.json`
   - `.planning/phases/20-brownies-batch/brownies-images.json`

2. Connects to Firestore using Firebase Admin SDK

3. For each recipe in the JSON files:
   - Query Firestore meals collection for a meal where `name` matches (case-insensitive)
   - AND `subcategory` contains "Muffins" or "Brownies" respectively
   - Update the `imageUrl` field with the Broma URL
   - Log success/failure for each recipe

4. Report summary: X of 21 muffins updated, Y of 21 brownies updated

The script should:
- Use existing Firebase config from the project
- Handle case where recipe name doesn't match exactly (log warning, continue)
- Be idempotent (safe to run multiple times)

Image data format in JSON files:
```json
[
  { "name": "Anything But Basic Muffins", "imageUrl": "https://bromabakery.com/..." },
  ...
]
```
  </action>
  <verify>Script exists at scripts/update-recipe-images.ts and compiles without errors</verify>
  <done>Script ready to run</done>
</task>

<task type="auto">
  <name>Task 2: Run Update Script</name>
  <files></files>
  <action>
Execute the script using ts-node or npx tsx:

```bash
npx tsx scripts/update-recipe-images.ts
```

Capture the output showing:
- Each recipe updated (name + imageUrl)
- Any recipes that couldn't be found
- Final summary counts
  </action>
  <verify>Script output shows 21 muffins and 21 brownies updated successfully</verify>
  <done>42 recipes updated in Firestore with Broma image URLs</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify Images Display</name>
  <what-built>42 recipe imageUrl fields updated to point to Broma Bakery</what-built>
  <how-to-verify>
1. Open the app at localhost:5173
2. Navigate to Baking > Broma > Muffins
3. Verify muffin recipes show thumbnail images (small square images in collapsed view)
4. Expand 2-3 recipes to verify full images display correctly
5. Navigate to Baking > Broma > Brownies
6. Verify brownie recipes show thumbnail images
7. Expand 2-3 recipes to verify full images display correctly
  </how-to-verify>
  <resume-signal>Type "verified" if all images display correctly, or list any recipes with missing/broken images</resume-signal>
</task>

</tasks>

<verification>
- [ ] Update script created and compiles
- [ ] Script executed successfully
- [ ] All 21 muffin recipes have imageUrl set
- [ ] All 21 brownie recipes have imageUrl set
- [ ] Images display correctly in recipe cards (thumbnails and expanded)
</verification>

<success_criteria>
- 42 recipes (21 muffins + 21 brownies) have imageUrl fields populated
- Images load from Broma Bakery URLs
- Recipe cards show thumbnails in collapsed view
- Full images visible in expanded view
- v1.3 Broma Bakery Import milestone complete
</success_criteria>

<output>
After completion, create `.planning/phases/22-recipe-image-upload/22-01-SUMMARY.md`
</output>
