---
phase: 19-muffins-batch
plan: 02
type: execute
---

<objective>
Generate import-ready JSON from scraped muffin recipes.

Purpose: Convert raw recipe data to app import format with proper categories and markdown.
Output: muffins-import.json ready for Settings import, muffins-images.json with image URLs for Phase 22.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-phase.md
./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-scraping-infrastructure/INGREDIENT-MAP.md
@.planning/phases/19-muffins-batch/muffins-batch-1.md
@.planning/phases/19-muffins-batch/muffins-batch-2.md
@.planning/phases/18-bars-batch/18-02-SUMMARY.md

**JSON format (from Phase 16):**
```json
{
  "name": "Recipe Name",
  "category": "baking",
  "subcategory": "Broma/Muffins",
  "ingredients": [
    { "name": "ingredient", "category": "baking", "defaultStore": "costco" }
  ],
  "instructions": "## Recipe Name\n\nMarkdown instructions...\n\n[Original Recipe](url)"
}
```

**Ingredient mapping:** Use INGREDIENT-MAP.md for category/store assignments.
**Instructions format:** Markdown with ## header, numbered steps, original URL at bottom.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Generate muffins-import.json</name>
  <files>.planning/phases/19-muffins-batch/muffins-import.json</files>
  <action>
    Parse muffins-batch-1.md and muffins-batch-2.md to extract all recipes.

    For each recipe:
    1. Set name to recipe title
    2. Set category to "baking"
    3. Set subcategory to "Broma/Muffins"
    4. Map each ingredient using INGREDIENT-MAP.md:
       - Extract ingredient name (strip quantities/notes)
       - Look up category and defaultStore
       - Default to "baking" category if not found
    5. Format instructions as markdown:
       - ## Recipe Name header
       - Numbered steps (1. Step - description format)
       - Original recipe link at bottom

    Output as JSON array in muffins-import.json.
  </action>
  <verify>muffins-import.json exists with valid JSON array</verify>
  <done>JSON file created with all muffin recipes in import format</done>
</task>

<task type="auto">
  <name>Task 2: Extract image URLs</name>
  <files>.planning/phases/19-muffins-batch/muffins-images.json</files>
  <action>
    For each recipe in muffins-import.json, WebFetch the original URL and extract the og:image meta tag.

    Create muffins-images.json mapping recipe names to image URLs:
    ```json
    [
      { "name": "Recipe Name", "imageUrl": "https://..." }
    ]
    ```

    This will be used in Phase 22 for image upload workflow.
  </action>
  <verify>muffins-images.json exists with image URLs for all recipes</verify>
  <done>Image URLs extracted for Phase 22 upload workflow</done>
</task>

<task type="auto">
  <name>Task 3: Validate JSON structure</name>
  <files>.planning/phases/19-muffins-batch/muffins-import.json</files>
  <action>
    Validate muffins-import.json:
    1. Valid JSON syntax (parseable)
    2. Each recipe has: name, category, subcategory, ingredients[], instructions
    3. Each ingredient has: name, category, defaultStore
    4. All categories are valid: produce, meat, dairy, pantry, frozen, bakery, snacks, beverages, baking
    5. Instructions contain markdown formatting and original URL

    Report any issues found.
  </action>
  <verify>JSON validation passes with no errors</verify>
  <done>All recipes validated and ready for import</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] muffins-import.json is valid JSON
- [ ] All recipes have required fields
- [ ] Ingredients mapped to valid categories
- [ ] Instructions are properly formatted markdown
- [ ] muffins-images.json has image URLs for all recipes
</verification>

<success_criteria>
- All tasks completed
- muffins-import.json ready for Settings > Import
- muffins-images.json ready for Phase 22 image upload
- No validation errors
</success_criteria>

<output>
After completion, create `.planning/phases/19-muffins-batch/19-02-SUMMARY.md` following summary template.
</output>
