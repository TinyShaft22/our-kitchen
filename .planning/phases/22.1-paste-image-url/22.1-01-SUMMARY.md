---
phase: 22.1-paste-image-url
plan: 01
subsystem: ui
tags: [meal-modal, image-upload, url-input]

dependency-graph:
  requires: [phase-22]
  provides: [paste-url-image-input]
  affects: []

tech-stack:
  added: []
  patterns: [mode-toggle-ui, url-validation, image-preview-from-url]

key-files:
  created: []
  modified:
    - src/components/meals/AddMealModal.tsx
    - src/components/meals/EditMealModal.tsx

decisions:
  - id: url-mode-toggle
    choice: Toggle buttons (Upload File / Paste URL)
    rationale: Clear visual indication of mode, easy switching
  - id: url-validation-approach
    choice: Format validation + load test
    rationale: Check URL format first, then attempt to load image for preview
  - id: url-storage
    choice: Direct URL storage without Firebase upload
    rationale: External URLs don't need to be re-uploaded, saves storage

metrics:
  duration: 8 min
  completed: 2026-01-19
---

# Phase 22.1 Plan 01: Paste Image URL Summary

**One-liner:** Toggle between file upload and paste URL modes in Add/Edit Meal modals with preview validation

## What Changed

### AddMealModal.tsx
- Added `imageInputMode` state toggle ('file' | 'url')
- Added `imageUrlInput`, `urlPreviewLoading`, `urlPreviewError` state variables
- Added `validateImageUrl()` function for URL format validation
- Added `handleUrlInputChange()`, `handleUrlInputBlur()`, `handleClearUrl()` handlers
- Added `handleImageModeChange()` to switch modes and clear other mode's state
- Updated `resetForm()` to reset all URL-related state
- Updated `handleSave()` to use URL directly when in URL mode (no Firebase upload)
- Updated Photo UI with mode toggle buttons and conditional file/URL input areas

### EditMealModal.tsx
- Same state variables and handlers as AddMealModal
- Updated `useEffect` to reset URL-related state when meal changes
- Updated `handleSave()` with smart Firebase image cleanup:
  - Added `isFirebaseStorageUrl()` helper to detect Firebase URLs
  - Added `deleteOldFirebaseImage()` helper for cleanup
  - Deletes old Firebase image when replacing with external URL
- Updated Photo UI with same mode toggle and URL input

## Decisions Made

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Mode toggle UI | Two buttons (Upload File / Paste URL) | Clear visual indication, accessible, consistent with app style |
| URL validation | Format check + image load test | Catches both malformed URLs and URLs that don't point to valid images |
| Firebase cleanup | Delete old image only if Firebase URL | Don't attempt to delete external URLs from Firebase Storage |
| URL storage | Direct to imageUrl field | No need to re-upload external images, saves bandwidth and storage |

## Deviations from Plan

None - plan executed exactly as written.

## Commits

| Hash | Type | Description |
|------|------|-------------|
| 433eb8e | feat | Add URL input mode to AddMealModal |
| dead46d | feat | Add URL input mode to EditMealModal |

## Verification Results

- [x] `npm run build` completes without errors
- [x] AddMealModal shows file/URL toggle above photo section
- [x] EditMealModal shows file/URL toggle above photo section
- [x] URL validation function present (validateImageUrl)
- [x] URL input handlers present (handleUrlInputChange, handleUrlInputBlur)
- [x] Direct URL save pattern present (imageUrl = imageUrlInput)
- [x] Firebase cleanup logic in EditMealModal

## Next Phase Readiness

This completes the v1.3 Broma Bakery Import milestone. All gap closure items addressed.

**Ready for:**
- v2.0 Alexa Integration planning (Phases 23-30)
