---
phase: 05-weekly-planning
plan: 03
type: execute
---

<objective>
Enable editing servings and removing meals from the weekly plan.

Purpose: Complete weekly plan management with edit and remove functionality.
Output: Working edit servings modal and remove confirmation, Phase 5 complete.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-phase.md
./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plans in this phase:
@.planning/phases/05-weekly-planning/05-01-SUMMARY.md
@.planning/phases/05-weekly-planning/05-02-SUMMARY.md

# Patterns to follow:
@src/components/meals/EditMealModal.tsx
@src/components/ui/ConfirmDialog.tsx

**Tech stack available:** React, TypeScript, Tailwind, Firebase/Firestore
**Established patterns:**
- ConfirmDialog for delete confirmation with danger variant
- Bottom-sheet modal for editing
- useWeeklyPlan provides removeMealFromWeek(mealId), updateServings(mealId, servings)

**Constraining decisions:**
- [04-03]: ConfirmDialog pattern for destructive actions
- [04-02]: Bottom-sheet modal for data entry
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create EditServingsModal component</name>
  <files>src/components/planning/EditServingsModal.tsx</files>
  <action>
Create a simple modal for editing servings of a weekly meal:
1. Props: isOpen, onClose, mealName (string), currentServings (number), onSave (servings: number) => Promise<void>
2. Bottom-sheet styling matching other modals
3. Header: "Edit Servings" with X close button
4. Display meal name (read-only)
5. Servings number input, pre-filled with currentServings
6. Save button (terracotta) calls onSave with new servings value
7. Cancel button closes modal
8. Validation: servings must be >= 1
  </action>
  <verify>TypeScript compiles, component exports correctly</verify>
  <done>EditServingsModal component with servings input and save/cancel</done>
</task>

<task type="auto">
  <name>Task 2: Wire edit and remove to Home page</name>
  <files>src/pages/Home.tsx</files>
  <action>
Complete the edit/remove functionality on Home page:
1. Import EditServingsModal and ConfirmDialog
2. Add state: editingEntry (WeeklyMealEntry | null), isEditModalOpen, removingEntry (WeeklyMealEntry | null), isRemoveDialogOpen
3. Replace stub handlers with real implementations:
   - handleEditServings: set editingEntry and open modal
   - handleCloseEditModal: close and clear editingEntry
   - handleSaveServings: call updateServings from useWeeklyPlan, close modal
   - handleRemove: set removingEntry and open confirm dialog
   - handleCloseRemoveDialog: close and clear removingEntry
   - handleConfirmRemove: call removeMealFromWeek, close dialog
4. Render EditServingsModal with proper props (resolve meal name from meals array)
5. Render ConfirmDialog for remove confirmation:
   - title: "Remove from Week"
   - message: "Remove {mealName} from this week's plan?"
   - confirmText: "Remove"
   - confirmVariant: "danger"
6. Pass real handlers to WeeklyMealCard: onEditServings, onRemove
  </action>
  <verify>npm run dev, can edit servings and remove meals from weekly plan</verify>
  <done>Edit servings and remove meal functionality complete on Home page</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Clicking edit (‚úèÔ∏è) on WeeklyMealCard opens EditServingsModal
- [ ] EditServingsModal shows meal name and current servings
- [ ] Saving new servings updates the weekly plan
- [ ] Clicking remove (üóëÔ∏è) on WeeklyMealCard opens ConfirmDialog
- [ ] Confirming remove deletes meal from weekly plan
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Full weekly plan CRUD: view, add, edit servings, remove
- Phase 5 complete
</success_criteria>

<output>
After completion, create `.planning/phases/05-weekly-planning/05-03-SUMMARY.md`

Include in summary:
- Phase 5 completion status
- All components created in this phase
- Ready for Phase 6: Grocery Generation
</output>
