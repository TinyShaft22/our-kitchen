---
phase: 02-firebase-setup
plan: 02
type: execute
---

<objective>
Implement household create/join functionality with UI and routing guard.

Purpose: Enable Nick and Bella to share data via 4-digit code without complex auth.
Output: Working household system - create code, join existing, persist in localStorage, gate app access.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-phase.md
./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/SPEC.md
@.planning/phases/02-firebase-setup/02-01-SUMMARY.md (will exist after Plan 1)
@src/config/firebase.ts (will exist after Plan 1)
@src/App.tsx
@src/index.css

**Tech stack available:** Vite, React 19, TypeScript, Tailwind v4, react-router-dom, Firebase/Firestore
**Theme colors:** cream, terracotta, sage, honey, charcoal
**UI constraints:** 44px min touch targets, rounded-soft (12px), shadow-soft

**Household flow from SPEC.md:**
- Create household: generates random 4-digit code, stores in Firestore, saves to localStorage
- Join household: enter 4-digit code, verify exists in Firestore, save to localStorage
- Code persists until manually cleared
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useHousehold hook for Firestore operations</name>
  <files>src/hooks/useHousehold.ts</files>
  <action>
    1. Create src/hooks/ directory if not exists
    2. Create useHousehold.ts with:

    ```typescript
    // State: householdCode (from localStorage), loading, error
    // Functions: createHousehold(), joinHousehold(code), leaveHousehold()

    // createHousehold():
    //   - Generate random 4-digit code (1000-9999)
    //   - Check if code exists in Firestore (doc reference: households/{code})
    //   - If exists, regenerate (max 10 attempts)
    //   - Create doc: { members: [], createdAt: serverTimestamp() }
    //   - Save to localStorage key: "householdCode"
    //   - Return code

    // joinHousehold(code):
    //   - Verify doc exists at households/{code}
    //   - If not exists, throw error "Invalid code"
    //   - Save to localStorage
    //   - Return true

    // leaveHousehold():
    //   - Remove from localStorage
    //   - Clear householdCode state

    // On mount: Read localStorage, set initial state
    ```

    3. Use Firestore modular API: doc(), getDoc(), setDoc() from 'firebase/firestore'
    4. Import db from '../config/firebase'

    Avoid: Using onSnapshot here - this hook just does one-time operations
    Avoid: Storing sensitive data - just the 4-digit code
  </action>
  <verify>
    - `npm run build` succeeds
    - Hook exports: householdCode, loading, error, createHousehold, joinHousehold, leaveHousehold
  </verify>
  <done>useHousehold hook with create/join/leave functions and localStorage persistence</done>
</task>

<task type="auto">
  <name>Task 2: Create JoinHousehold page UI</name>
  <files>src/pages/JoinHousehold.tsx</files>
  <action>
    1. Create JoinHousehold.tsx with two-tab interface:
       - Tab 1: "Create New" - button to generate household
       - Tab 2: "Join Existing" - 4-digit code input + join button

    2. UI structure:
       ```
       - Centered card on cream background
       - App title "Our Kitchen" at top
       - Tab buttons (terracotta active, charcoal inactive)
       - Content area:
         - Create: "Start a new household" text + "Create Household" button
         - Join: 4-digit input (large, centered) + "Join" button
       - Error message display (if any)
       - Loading states on buttons
       ```

    3. Styling:
       - Card: bg-white, rounded-softer (16px), shadow-soft, p-6
       - Title: text-2xl, font-bold, text-charcoal
       - Input: text-center, text-2xl, tracking-widest, w-32, border-2 focus:border-terracotta
       - Buttons: bg-terracotta, text-white, rounded-soft, h-11 (44px), px-6
       - Min touch targets: h-11 (44px) on all interactive elements

    4. Use useHousehold hook for all operations
    5. On success: navigate to "/" (home)

    Avoid: Complex form libraries - just useState for input
    Avoid: Auto-focus on mobile - let user tap
  </action>
  <verify>
    - `npm run build` succeeds
    - Page renders with create/join tabs
    - Buttons are 44px tall minimum
  </verify>
  <done>JoinHousehold page with create/join UI matching app theme</done>
</task>

<task type="auto">
  <name>Task 3: Add routing guard to require household</name>
  <files>src/App.tsx</files>
  <action>
    1. Import useHousehold hook
    2. Import JoinHousehold page
    3. Add conditional routing logic:
       ```
       const { householdCode, loading } = useHousehold();

       if (loading) {
         return <LoadingScreen />; // Simple centered spinner
       }

       if (!householdCode) {
         return <JoinHousehold />;
       }

       // Existing app with navigation
       return (
         <BrowserRouter>
           ...existing routes and navigation...
         </BrowserRouter>
       );
       ```

    4. Create simple LoadingScreen component inline or extract:
       - Centered on screen
       - "Loading..." text or simple spinner
       - bg-cream

    5. JoinHousehold should NOT be inside BrowserRouter since it's a gate

    Avoid: Wrapping JoinHousehold in router - it's standalone
    Avoid: Flash of JoinHousehold when code exists - check loading first
  </action>
  <verify>
    - `npm run build` succeeds
    - Without localStorage code: shows JoinHousehold
    - With localStorage code: shows main app
  </verify>
  <done>App gates on household code, redirects to JoinHousehold if not set</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] `npm run dev` - without code, shows JoinHousehold page
- [ ] Create household works (check localStorage and Firestore)
- [ ] Join household works (existing code)
- [ ] After join/create, main app with navigation appears
- [ ] No TypeScript errors
</verification>

<success_criteria>
- useHousehold hook manages household state
- JoinHousehold page has create/join UI
- App requires household code to access
- 4-digit codes persist in localStorage
- UI matches warm theme (terracotta buttons, cream bg)
</success_criteria>

<output>
After completion, create `.planning/phases/02-firebase-setup/02-02-SUMMARY.md`

Phase 2 complete marker: This is the final plan in Phase 2.
</output>
