---
phase: 18-bars-batch
plan: 02
type: execute
---

<objective>
Generate import-ready JSON from scraped bar recipes.

Purpose: Transform scraped recipe data into app-compatible JSON format.
Output: bars-import.json with all bar recipes ready for Phase 21 import.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-phase.md
./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/16-scraping-infrastructure/INGREDIENT-MAP.md
@.planning/phases/17-cookies-batch/17-02-SUMMARY.md
@.planning/phases/17-cookies-batch/cookies-import.json (first 50 lines for format reference)

**JSON format (from cookies-import.json):**
```json
{
  "version": 1,
  "meals": [
    {
      "name": "Recipe Name",
      "servings": 12,
      "isBaking": true,
      "ingredients": [
        { "name": "ingredient", "category": "baking|dairy|pantry|produce", "defaultStore": "costco|trader-joes|safeway" }
      ],
      "instructions": "## Title\n\n**Yield:** X\n**Prep:** X min | **Bake:** X min\n\n### Ingredients\n- list...\n\n### Instructions\n\n1. Step name - description\n\n---\n[Original recipe](URL)",
      "subcategory": "Broma/Bars"
    }
  ]
}
```

**Ingredient mapping:** Use INGREDIENT-MAP.md for category/store assignments.
**Subcategory:** "Broma/Bars" for all recipes.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Generate bars-import.json</name>
  <files>.planning/phases/18-bars-batch/bars-import.json</files>
  <action>
    Read bars-batch-1.md and bars-batch-2.md (created in 18-01).

    For each recipe, create JSON entry with:
    1. **name**: Recipe title (clean, no extra formatting)
    2. **servings**: Parse yield number (use "makes" count or "serves" count)
    3. **isBaking**: true
    4. **ingredients**: Array of {name, category, defaultStore}
       - Map each ingredient using INGREDIENT-MAP.md
       - Strip quantities, keep just ingredient name
       - Match variations/aliases from the map
       - Default unmapped: category="baking", defaultStore="costco"
    5. **instructions**: Markdown formatted string with:
       - ## Title header
       - **Yield:** and **Prep:** | **Bake:** line
       - ### Ingredients section with full quantities
       - ### Instructions with numbered steps: "N. Step name - description"
       - --- divider
       - [Original recipe](URL) link
    6. **subcategory**: "Broma/Bars"

    Write complete JSON array with all recipes.
  </action>
  <verify>bars-import.json exists and is valid JSON (use `cat file | head -50` to check structure)</verify>
  <done>JSON file created with all bar recipes in import format</done>
</task>

<task type="auto">
  <name>Task 2: Validate JSON structure</name>
  <files>.planning/phases/18-bars-batch/bars-import.json</files>
  <action>
    Verify bars-import.json:
    1. Valid JSON syntax (parse check)
    2. Has "version": 1 and "meals" array
    3. Each meal has required fields: name, servings, isBaking, ingredients, instructions, subcategory
    4. Each ingredient has: name, category, defaultStore
    5. Category values are valid: produce, meat, dairy, pantry, frozen, bakery, snacks, beverages, baking
    6. Store values are valid: costco, trader-joes, safeway, bel-air

    Report recipe count and any validation issues.
  </action>
  <verify>JSON validates with no errors</verify>
  <done>All recipes validated, count matches expected (~25)</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>bars-import.json with all bar recipes from Broma Bakery</what-built>
  <how-to-verify>
    1. Open .planning/phases/18-bars-batch/bars-import.json
    2. Verify recipe count matches expectation (~25 recipes)
    3. Spot-check 2-3 recipes for:
       - Correct ingredient categorization
       - Complete instructions with steps
       - Original recipe URL present
    4. Confirm subcategory is "Broma/Bars" for all
  </how-to-verify>
  <resume-signal>Type "approved" to complete phase, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] bars-import.json exists and is valid JSON
- [ ] Recipe count matches scraped recipes from 18-01
- [ ] All ingredients mapped to categories per INGREDIENT-MAP.md
- [ ] Instructions formatted consistently with cookies-import.json pattern
</verification>

<success_criteria>
- All tasks completed
- bars-import.json ready for Phase 21 import
- Human verification approved
- Phase 18 complete
</success_criteria>

<output>
After completion, create `.planning/phases/18-bars-batch/18-02-SUMMARY.md` following summary template.
</output>
