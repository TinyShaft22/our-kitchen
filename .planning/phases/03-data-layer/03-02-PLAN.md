---
phase: 03-data-layer
plan: 02
type: execute
---

<objective>
Create Firestore hooks for meals, grocery list, and weekly planning.

Purpose: Enable CRUD operations and real-time sync for core data collections.
Output: Three hooks (useMeals, useGroceryList, useWeeklyPlan) with full Firestore integration.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-phase.md
./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/SPEC.md
@src/config/firebase.ts
@src/hooks/useHousehold.ts
@src/types/index.ts

**From Phase 2:**
- Firebase SDK with modular imports
- useHousehold hook pattern to follow
- Security rules require householdCode field on all documents

**Pattern to follow (from useHousehold.ts):**
- useState for data, loading, error states
- useCallback for operations
- Firestore modular imports (collection, doc, query, where, onSnapshot, addDoc, updateDoc, deleteDoc)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useMeals hook</name>
  <files>src/hooks/useMeals.ts</files>
  <action>Create hook for meal CRUD with real-time sync:

  **Dependencies:**
  - Takes householdCode as parameter (from useHousehold)
  - Uses types from src/types/index.ts

  **State:**
  - meals: Meal[] (real-time from Firestore)
  - loading: boolean
  - error: string | null

  **Operations:**
  - addMeal(meal: Omit<Meal, 'id' | 'householdCode'>): Promise<string> - returns new doc ID
  - updateMeal(id: string, updates: Partial<Meal>): Promise<void>
  - deleteMeal(id: string): Promise<void>

  **Real-time listener:**
  - useEffect with onSnapshot on meals collection
  - Query: where('householdCode', '==', householdCode)
  - Clean up listener on unmount
  - Return early if no householdCode

  **Firestore imports needed:** collection, query, where, onSnapshot, addDoc, updateDoc, deleteDoc, doc

  Auto-inject householdCode into addMeal. Don't allow updating householdCode in updateMeal.</action>
  <verify>npm run build succeeds, hook exports properly typed</verify>
  <done>useMeals hook with real-time sync and CRUD operations</done>
</task>

<task type="auto">
  <name>Task 2: Create useGroceryList hook</name>
  <files>src/hooks/useGroceryList.ts</files>
  <action>Create hook for grocery list management:

  **Dependencies:**
  - Takes householdCode as parameter
  - Uses GroceryItem type from src/types/index.ts

  **State:**
  - items: GroceryItem[] (real-time from Firestore)
  - loading: boolean
  - error: string | null

  **Operations:**
  - addItem(item: Omit<GroceryItem, 'id' | 'householdCode'>): Promise<string>
  - updateItem(id: string, updates: Partial<GroceryItem>): Promise<void>
  - deleteItem(id: string): Promise<void>
  - updateStatus(id: string, status: GroceryItem['status']): Promise<void> - convenience method
  - clearBoughtItems(): Promise<void> - delete all items with status 'bought'

  **Real-time listener:**
  - onSnapshot on groceryList collection
  - Query: where('householdCode', '==', householdCode)
  - Order by category then name for consistent display

  Same pattern as useMeals. Auto-inject householdCode on add.</action>
  <verify>npm run build succeeds, hook exports properly typed</verify>
  <done>useGroceryList hook with real-time sync and CRUD + status operations</done>
</task>

<task type="auto">
  <name>Task 3: Create useWeeklyPlan hook</name>
  <files>src/hooks/useWeeklyPlan.ts</files>
  <action>Create hook for weekly meal planning:

  **Dependencies:**
  - Takes householdCode as parameter
  - Uses WeeklyMeal, WeeklyMealEntry types from src/types/index.ts

  **State:**
  - currentWeek: WeeklyMeal | null (the current week's plan)
  - loading: boolean
  - error: string | null

  **Helper function:**
  - getWeekId(): string - returns current week identifier as 'YYYY-WNN' format (e.g., '2026-W02')
  - Use: new Date().toISOString().slice(0,4) for year, calculate week number

  **Operations:**
  - addMealToWeek(mealId: string, servings: number): Promise<void> - creates week doc if doesn't exist, appends to meals array
  - removeMealFromWeek(mealId: string): Promise<void> - removes from meals array
  - updateServings(mealId: string, servings: number): Promise<void> - updates servings for a meal in the week

  **Real-time listener:**
  - onSnapshot on single document: weeklyMeals/{weekId}
  - weekId from getWeekId() helper
  - Create document if doesn't exist on first add

  Use arrayUnion/arrayRemove for meals array manipulation, or read-modify-write pattern for updates.</action>
  <verify>npm run build succeeds, hook exports properly typed, week ID format is correct</verify>
  <done>useWeeklyPlan hook with real-time sync for current week's meals</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without TypeScript errors
- [ ] All three hooks export from src/hooks/
- [ ] Each hook follows same pattern as useHousehold.ts
- [ ] Real-time listeners clean up on unmount
- [ ] householdCode auto-injected on create operations
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Hooks ready for use in UI components
- Real-time sync working
</success_criteria>

<output>
After completion, create `.planning/phases/03-data-layer/03-02-SUMMARY.md`
</output>
