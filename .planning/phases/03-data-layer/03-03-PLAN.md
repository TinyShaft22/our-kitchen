---
phase: 03-data-layer
plan: 03
type: execute
---

<objective>
Create Firestore hooks for staples and baking essentials.

Purpose: Complete the data layer with hooks for Bella's baking corner and always-grab staples.
Output: Two hooks (useStaples, useBaking) with full Firestore integration. Phase 3 complete.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-phase.md
./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/SPEC.md
@src/config/firebase.ts
@src/hooks/useHousehold.ts
@src/hooks/useMeals.ts
@src/types/index.ts

**From Phase 3 Plan 1-2:**
- Types defined in src/types/index.ts
- Hook pattern established in useMeals.ts
- Offline persistence enabled

**Pattern to follow:**
- Same structure as useMeals/useGroceryList
- Real-time onSnapshot listener
- CRUD operations with householdCode injection
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useStaples hook</name>
  <files>src/hooks/useStaples.ts</files>
  <action>Create hook for "always grab" staples management:

  **Dependencies:**
  - Takes householdCode as parameter
  - Uses Staple type from src/types/index.ts

  **State:**
  - staples: Staple[] (real-time from Firestore)
  - loading: boolean
  - error: string | null

  **Operations:**
  - addStaple(staple: Omit<Staple, 'id' | 'householdCode'>): Promise<string>
  - updateStaple(id: string, updates: Partial<Staple>): Promise<void>
  - deleteStaple(id: string): Promise<void>
  - toggleEnabled(id: string, enabled: boolean): Promise<void> - convenience method for enable/disable

  **Computed (optional but helpful):**
  - enabledStaples: derived from staples.filter(s => s.enabled)

  **Real-time listener:**
  - onSnapshot on staples collection
  - Query: where('householdCode', '==', householdCode)

  Same pattern as other hooks. Auto-inject householdCode on add.</action>
  <verify>npm run build succeeds, hook exports properly typed</verify>
  <done>useStaples hook with real-time sync and CRUD + toggle operations</done>
</task>

<task type="auto">
  <name>Task 2: Create useBaking hook</name>
  <files>src/hooks/useBaking.ts</files>
  <action>Create hook for Bella's baking inventory:

  **Dependencies:**
  - Takes householdCode as parameter
  - Uses BakingEssential type from src/types/index.ts

  **State:**
  - essentials: BakingEssential[] (real-time from Firestore)
  - loading: boolean
  - error: string | null

  **Operations:**
  - addEssential(essential: Omit<BakingEssential, 'id' | 'householdCode'>): Promise<string>
  - updateEssential(id: string, updates: Partial<BakingEssential>): Promise<void>
  - deleteEssential(id: string): Promise<void>
  - updateStatus(id: string, status: BakingEssential['status']): Promise<void> - convenience for stocked/low/out

  **Computed (optional but helpful):**
  - lowStockItems: derived from essentials.filter(e => e.status === 'low' || e.status === 'out')

  **Real-time listener:**
  - onSnapshot on bakingEssentials collection
  - Query: where('householdCode', '==', householdCode)

  Same pattern as other hooks. Auto-inject householdCode on add.</action>
  <verify>npm run build succeeds, hook exports properly typed</verify>
  <done>useBaking hook with real-time sync and CRUD + status operations</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without TypeScript errors
- [ ] Both hooks export from src/hooks/
- [ ] All 5 data hooks now exist: useMeals, useGroceryList, useWeeklyPlan, useStaples, useBaking
- [ ] Real-time listeners clean up on unmount
- [ ] householdCode auto-injected on create operations
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Phase 3 complete: All types defined, all hooks created, offline persistence enabled
- Data layer ready for UI implementation in Phase 4
</success_criteria>

<output>
After completion, create `.planning/phases/03-data-layer/03-03-SUMMARY.md`

Include in summary:
- Phase 3 complete status
- List of all hooks created across all 3 plans
- Confirmation that data layer is ready for Phase 4: Meal Library
</output>
