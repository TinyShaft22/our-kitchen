---
phase: 20-brownies-batch
plan: 02
type: execute
---

<objective>
Generate import-ready JSON from scraped brownie recipes.

Purpose: Transform scraped recipe data into app-compatible JSON format.
Output: brownies-import.json with all brownie recipes ready for Phase 21 import, plus brownies-images.json with image URLs for Phase 22.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-phase.md
./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/16-scraping-infrastructure/INGREDIENT-MAP.md
@.planning/phases/19-muffins-batch/19-02-SUMMARY.md
@.planning/phases/18-bars-batch/bars-import.json (first 50 lines for format reference)

**JSON format (from prior batches):**
```json
{
  "version": 1,
  "meals": [
    {
      "name": "Recipe Name",
      "servings": 12,
      "isBaking": true,
      "ingredients": [
        { "name": "ingredient", "category": "baking|dairy|pantry|produce", "defaultStore": "costco|trader-joes|safeway" }
      ],
      "instructions": "## Title\n\n**Yield:** X\n**Prep:** X min | **Bake:** X min\n\n### Ingredients\n- list...\n\n### Instructions\n\n1. Step name - description\n\n---\n[Original recipe](URL)",
      "subcategory": "Broma/Brownies"
    }
  ]
}
```

**Ingredient mapping:** Use INGREDIENT-MAP.md for category/store assignments.
**Subcategory:** "Broma/Brownies" for all recipes.

**Image JSON format (from prior batches):**
```json
[
  { "name": "Recipe Name", "imageUrl": "https://bromabakery.com/wp-content/..." }
]
```
</context>

<tasks>

<task type="auto">
  <name>Task 1: Generate brownies-import.json</name>
  <files>.planning/phases/20-brownies-batch/brownies-import.json</files>
  <action>
    Read brownies-batch-1.md and brownies-batch-2.md (created in 20-01).

    For each recipe, create JSON entry with:
    1. **name**: Recipe title (clean, no extra formatting)
    2. **servings**: Parse yield number (use "makes" count or "serves" count)
    3. **isBaking**: true
    4. **ingredients**: Array of {name, category, defaultStore}
       - Map each ingredient using INGREDIENT-MAP.md
       - Strip quantities, keep just ingredient name
       - Match variations/aliases from the map
       - Default unmapped: category="baking", defaultStore="costco"
    5. **instructions**: Markdown formatted string with:
       - ## Title header
       - **Yield:** and **Prep:** | **Bake:** line
       - ### Ingredients section with full quantities
       - ### Instructions with numbered steps: "N. Step name - description"
       - --- divider
       - [Original recipe](URL) link
    6. **subcategory**: "Broma/Brownies"

    Write complete JSON array with all recipes.
  </action>
  <verify>brownies-import.json exists and is valid JSON (use `cat file | head -50` to check structure)</verify>
  <done>JSON file created with all brownie recipes in import format</done>
</task>

<task type="auto">
  <name>Task 2: Generate brownies-images.json</name>
  <files>.planning/phases/20-brownies-batch/brownies-images.json</files>
  <action>
    Extract image URLs from brownies-batch-1.md and brownies-batch-2.md.

    Create JSON array with:
    - name: Recipe name (must match brownies-import.json exactly)
    - imageUrl: og:image URL from scraped data

    This file enables Phase 22 image upload workflow.
  </action>
  <verify>brownies-images.json exists with image URLs for all recipes</verify>
  <done>Image URL mapping file created</done>
</task>

<task type="auto">
  <name>Task 3: Validate JSON files</name>
  <files>.planning/phases/20-brownies-batch/brownies-import.json, .planning/phases/20-brownies-batch/brownies-images.json</files>
  <action>
    Verify brownies-import.json:
    1. Valid JSON syntax (parse check)
    2. Has "version": 1 and "meals" array
    3. Each meal has required fields: name, servings, isBaking, ingredients, instructions, subcategory
    4. Each ingredient has: name, category, defaultStore
    5. Category values are valid: produce, meat, dairy, pantry, frozen, bakery, snacks, beverages, baking
    6. Store values are valid: costco, trader-joes, safeway, bel-air

    Verify brownies-images.json:
    1. Valid JSON array
    2. Each entry has name and imageUrl
    3. Recipe names match between both files

    Report recipe counts and any validation issues.
  </action>
  <verify>Both JSON files validate with no errors</verify>
  <done>All recipes validated, counts match expected (~21)</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] brownies-import.json exists and is valid JSON
- [ ] brownies-images.json exists with all image URLs
- [ ] Recipe count matches scraped recipes from 20-01
- [ ] All ingredients mapped to categories per INGREDIENT-MAP.md
- [ ] Instructions formatted consistently with prior batch pattern
</verification>

<success_criteria>
- All tasks completed
- brownies-import.json ready for Phase 21 import
- brownies-images.json ready for Phase 22 image upload
- Phase 20 complete
</success_criteria>

<output>
After completion, create `.planning/phases/20-brownies-batch/20-02-SUMMARY.md` following summary template.
</output>
