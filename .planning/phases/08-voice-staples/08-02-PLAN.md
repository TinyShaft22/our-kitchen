---
phase: 08-voice-staples
plan: 02
type: execute
---

<objective>
Complete staples CRUD and integrate enabled staples into grocery list generation.

Purpose: Allow full management of staples and ensure they're automatically included when generating grocery lists.
Output: Edit/delete staple functionality, staples included in generateFromWeeklyPlan output.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-phase.md
./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan in this phase:
@.planning/phases/08-voice-staples/08-01-SUMMARY.md

# Existing code:
@src/types/index.ts
@src/hooks/useStaples.ts
@src/hooks/useGroceryList.ts
@src/utils/generateGroceryItems.ts
@src/pages/GroceryListPage.tsx
@src/components/ui/ConfirmDialog.tsx
@src/components/meals/EditMealModal.tsx

**Tech stack available:** React, TypeScript, Tailwind, Firebase/Firestore
**Established patterns:** ConfirmDialog for deletions, EditMealModal for edit forms
**Key decisions:**
- GrocerySource type includes 'staple' value
- enabledStaples computed value from useStaples
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Edit/Delete functionality for staples</name>
  <files>src/components/grocery/EditStapleModal.tsx, src/pages/GroceryListPage.tsx</files>
  <action>
**EditStapleModal (new file):**
Create edit modal following EditMealModal pattern:
- Bottom sheet style modal
- Pre-populate form with existing staple data (name, store, category, enabled)
- Store and category use select dropdowns with STORES/CATEGORIES constants
- Save calls updateStaple from useStaples hook
- Cancel closes modal

**GroceryListPage updates:**
1. Add state for editingStaple and deleteConfirmStaple
2. Wire StapleCard onEdit to set editingStaple
3. Wire StapleCard onDelete to set deleteConfirmStaple
4. Render EditStapleModal when editingStaple is set
5. Render ConfirmDialog for delete confirmation
6. On delete confirm, call deleteStaple from useStaples
7. Clear state after successful operations
  </action>
  <verify>npm run build passes, can edit staple name/store/category, can delete with confirmation</verify>
  <done>Full CRUD operations work for staples - view, add, edit, delete all functional</done>
</task>

<task type="auto">
  <name>Task 2: Include enabled staples in grocery generation</name>
  <files>src/pages/GroceryListPage.tsx, src/hooks/useGroceryList.ts</files>
  <action>
**Modify handleGenerate in GroceryListPage:**
1. Get enabledStaples from useStaples hook (already available)
2. After generating meal items, create staple grocery items:
   - Map each enabled staple to GroceryItemInput format
   - name: staple.name
   - qty: 1 (staples are presence-based, not quantity-based)
   - unit: 'item' (or empty string)
   - category: staple.category
   - store: staple.store
   - source: 'staple'
3. Combine meal items + staple items before calling generateFromWeeklyPlan
4. Alternatively: create separate addStaplesToGroceryList method

**Option B (cleaner approach):**
Add includeStaples parameter to generateFromWeeklyPlan:
- Modify useGroceryList.generateFromWeeklyPlan to accept optional Staple[] array
- Inside, convert staples to GroceryItem format with source: 'staple'
- Batch add alongside meal items

Use Option B for cleaner separation of concerns.

**Visual indicator:**
Staple-sourced items should show a small indicator. Update GroceryItemCard:
- If item.source === 'staple', show small star/pin emoji or "staple" badge
- Use subtle styling (charcoal/50 text, small font)
  </action>
  <verify>npm run build passes, generating grocery list includes enabled staples, staple items show indicator</verify>
  <done>Enabled staples automatically appear in generated grocery list with visual indicator</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Can edit existing staple (name, store, category)
- [ ] Can delete staple with confirmation dialog
- [ ] Generating grocery list includes all enabled staples
- [ ] Staple-sourced items show visual indicator on grocery list
- [ ] Disabled staples are NOT included in generation
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Full staples workflow: manage staples -> generate list -> see staples on list
</success_criteria>

<output>
After completion, create `.planning/phases/08-voice-staples/08-02-SUMMARY.md`
</output>
