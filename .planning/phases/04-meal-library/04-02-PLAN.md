---
phase: 04-meal-library
plan: 02
type: execute
---

<objective>
Build the Add Meal modal with ingredient management functionality.

Purpose: Enable users to create new meals with a list of ingredients, the core data entry for the meal library.
Output: Working modal that creates meals with ingredients via the useMeals hook.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-phase.md
./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Prior plan context:**
@.planning/phases/04-meal-library/04-01-SUMMARY.md

**Key files:**
@src/types/index.ts
@src/hooks/useMeals.ts
@src/pages/MealLibrary.tsx

**Tech stack available:** React, TypeScript, Tailwind CSS v4, useMeals.addMeal()
**Established patterns:** STORES and CATEGORIES constants for dropdowns
**Constraining decisions:**
- Ingredient interface: name, qty, unit, category, defaultStore
- Meal interface: name, servings, ingredients[], isBaking
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AddMealModal component structure</name>
  <files>src/components/meals/AddMealModal.tsx, src/pages/MealLibrary.tsx</files>
  <action>
    Create AddMealModal component with props: isOpen, onClose, onSave (receives meal data).

    Modal structure:
    - Backdrop: fixed inset-0 bg-black/50 z-50 (click to close)
    - Panel: fixed bottom-0 left-0 right-0 bg-white rounded-t-softer p-4 z-50 max-h-[90vh] overflow-y-auto
    - Header: "Add Meal" title + X close button
    - Form fields:
      - Meal name (text input, required)
      - Servings (number input, default 2)
      - isBaking checkbox ("This is a baking recipe")
    - Ingredients section (placeholder div for Task 2)
    - Footer: Cancel and Save buttons

    State management:
    - name: string
    - servings: number
    - isBaking: boolean
    - ingredients: Ingredient[] (empty initially)

    Wire into MealLibrary.tsx:
    - Import AddMealModal
    - Render when isAddModalOpen is true
    - onClose: setIsAddModalOpen(false)
    - onSave: call addMeal from useMeals, then close modal

    Styling: 44px touch targets, cream/terracotta theme colors, rounded-soft inputs.
  </action>
  <verify>npm run build succeeds, FAB opens modal, modal closes on X or backdrop click</verify>
  <done>Modal opens/closes correctly, form fields render, basic save flow works (without ingredients)</done>
</task>

<task type="auto">
  <name>Task 2: Implement ingredient entry within modal</name>
  <files>src/components/meals/AddMealModal.tsx, src/components/meals/IngredientInput.tsx</files>
  <action>
    Create IngredientInput component for entering a single ingredient:
    - Props: ingredient (Ingredient | null), onChange, onRemove
    - Fields in a compact layout:
      - Name (text, flex-1)
      - Qty (number, w-16)
      - Unit (text, w-20, e.g., "cups", "lbs", "each")
      - Category (select from CATEGORIES)
      - Store (select from STORES)
    - Remove button (X icon, calls onRemove)

    Update AddMealModal:
    - "Add Ingredient" button below ingredients list
    - When clicked, add empty ingredient to state: { name: '', qty: 1, unit: '', category: 'pantry', defaultStore: 'costco' }
    - Render IngredientInput for each ingredient in state
    - onChange updates that ingredient in the array
    - onRemove filters it out

    Save validation:
    - Meal name required
    - At least 1 ingredient with name filled
    - Filter out empty ingredients before saving

    On save: construct Meal object (without id/householdCode - hook handles those), call onSave.
  </action>
  <verify>npm run dev, add meal with 2+ ingredients, verify saved to Firestore, appears in list</verify>
  <done>Can add meal with multiple ingredients, ingredients persist correctly, validation prevents empty saves</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Modal opens from FAB click
- [ ] Can enter meal name, servings, toggle isBaking
- [ ] Can add multiple ingredients with all fields
- [ ] Can remove ingredients
- [ ] Save creates meal in Firestore (check Firebase console or meal list updates)
- [ ] Modal closes after successful save
- [ ] Empty meal name or no ingredients shows validation feedback
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Full add meal flow works end-to-end
- Ingredients correctly stored with all fields (name, qty, unit, category, defaultStore)
</success_criteria>

<output>
After completion, create `.planning/phases/04-meal-library/04-02-SUMMARY.md`
</output>
