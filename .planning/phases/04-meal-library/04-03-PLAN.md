---
phase: 04-meal-library
plan: 03
type: execute
---

<objective>
Add edit and delete functionality to complete the meal library CRUD operations.

Purpose: Enable users to modify existing meals and remove unwanted ones.
Output: Full CRUD capability for meals - create, read, update, delete all working.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-phase.md
./.claude/get-shit-done/templates/summary.md
./.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Prior plan context:**
@.planning/phases/04-meal-library/04-01-SUMMARY.md
@.planning/phases/04-meal-library/04-02-SUMMARY.md

**Key files:**
@src/types/index.ts
@src/hooks/useMeals.ts
@src/pages/MealLibrary.tsx
@src/components/meals/AddMealModal.tsx
@src/components/meals/MealCard.tsx

**Tech stack available:** React, TypeScript, Tailwind CSS v4, useMeals.updateMeal(), useMeals.deleteMeal()
**Established patterns:** AddMealModal structure, MealCard with onEdit/onDelete props
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create EditMealModal by extending AddMealModal</name>
  <files>src/components/meals/EditMealModal.tsx, src/pages/MealLibrary.tsx</files>
  <action>
    Create EditMealModal component - can either:
    Option A: Duplicate AddMealModal with pre-populated state (simpler)
    Option B: Refactor AddMealModal to accept optional meal prop (cleaner but more changes)

    Choose Option A for speed. EditMealModal:
    - Props: isOpen, onClose, meal (Meal to edit), onSave
    - Same structure as AddMealModal
    - Initialize state from meal prop (name, servings, isBaking, ingredients)
    - Header: "Edit Meal" instead of "Add Meal"
    - Save button: "Update" instead of "Save"

    Update MealLibrary.tsx:
    - Add state: editingMeal: Meal | null
    - Add state: isEditModalOpen: boolean
    - Wire MealCard onEdit: setEditingMeal(meal), setIsEditModalOpen(true)
    - Render EditMealModal when isEditModalOpen && editingMeal
    - onSave: call updateMeal(editingMeal.id, updates), then close modal
    - onClose: setIsEditModalOpen(false), setEditingMeal(null)
  </action>
  <verify>npm run build succeeds, edit button opens modal with pre-filled data, update persists</verify>
  <done>Edit modal opens with existing meal data, changes save correctly to Firestore</done>
</task>

<task type="auto">
  <name>Task 2: Add delete confirmation dialog</name>
  <files>src/components/ui/ConfirmDialog.tsx, src/pages/MealLibrary.tsx</files>
  <action>
    Create reusable ConfirmDialog component:
    - Props: isOpen, onClose, onConfirm, title, message, confirmText, confirmVariant ('danger' | 'primary')
    - Modal structure similar to AddMealModal but smaller
    - Two buttons: Cancel (secondary) and Confirm (primary or danger based on variant)
    - Danger variant: bg-red-500 for confirm button

    Update MealLibrary.tsx:
    - Add state: deletingMeal: Meal | null
    - Add state: isDeleteDialogOpen: boolean
    - Wire MealCard onDelete: setDeletingMeal(meal), setIsDeleteDialogOpen(true)
    - Render ConfirmDialog:
      - title: "Delete Meal"
      - message: `Are you sure you want to delete "${deletingMeal?.name}"? This cannot be undone.`
      - confirmText: "Delete"
      - confirmVariant: "danger"
    - onConfirm: call deleteMeal(deletingMeal.id), then close dialog
    - onClose: setIsDeleteDialogOpen(false), setDeletingMeal(null)
  </action>
  <verify>npm run build succeeds, delete shows confirmation, confirm deletes meal, cancel closes dialog</verify>
  <done>Delete requires confirmation, meal removed from Firestore on confirm, dialog closes properly</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Meal Library CRUD functionality</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:5173/meals
    3. Test ADD: Click FAB (+), fill in meal name "Test Pasta", servings 4, add 2 ingredients (pasta, sauce), save
    4. Verify: New meal appears in list with correct info
    5. Test EDIT: Click edit on Test Pasta, change name to "Updated Pasta", add another ingredient, update
    6. Verify: Changes reflected in meal card
    7. Test DELETE: Click delete on Updated Pasta, confirm deletion
    8. Verify: Meal removed from list
    9. Check Firebase Console: Verify data matches UI state
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Edit modal opens with pre-filled meal data
- [ ] Edit saves changes correctly
- [ ] Delete shows confirmation dialog
- [ ] Delete removes meal on confirm
- [ ] Cancel closes dialogs without action
- [ ] All CRUD operations reflect in Firestore
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Human verification approved
- No TypeScript errors
- Full CRUD cycle works: Create, Read, Update, Delete
- Phase 4 complete
</success_criteria>

<output>
After completion, create `.planning/phases/04-meal-library/04-03-SUMMARY.md` with:
- Phase 4 completion status
- All files created/modified across 04-01, 04-02, 04-03
- Ready for Phase 5: Weekly Planning
</output>
