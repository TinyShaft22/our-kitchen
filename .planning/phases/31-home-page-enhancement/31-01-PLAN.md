---
phase: 31-home-page-enhancement
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/index.ts
  - src/hooks/useWeeklyPlan.ts
autonomous: true

must_haves:
  truths:
    - "Weekly entries can have an optional day assignment"
    - "Meals can be assigned to specific days via hook function"
    - "Snacks can be assigned to specific days via hook function"
    - "Existing entries without day field continue to work (backward compatible)"
  artifacts:
    - path: "src/types/index.ts"
      provides: "DayOfWeek type and DAY_NAMES constant"
      contains: "DayOfWeek"
    - path: "src/hooks/useWeeklyPlan.ts"
      provides: "updateMealDay and updateSnackDay functions"
      exports: ["updateMealDay", "updateSnackDay"]
  key_links:
    - from: "src/hooks/useWeeklyPlan.ts"
      to: "src/types/index.ts"
      via: "imports DayOfWeek type"
      pattern: "import.*DayOfWeek"
---

<objective>
Add data model support for day-based meal planning.

Purpose: Enable meals and snacks to be assigned to specific days of the week, supporting the upcoming week view with drag-and-drop.

Output: Updated types with DayOfWeek and hook functions for day assignment.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/31-home-page-enhancement/CONTEXT.md

@src/types/index.ts
@src/hooks/useWeeklyPlan.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add DayOfWeek type and update entry interfaces</name>
  <files>src/types/index.ts</files>
  <action>
Add the following to src/types/index.ts:

1. Add DayOfWeek type after the existing type definitions (after line ~17):
```typescript
// Day of week (1=Monday, 7=Sunday) - ISO 8601 standard
export type DayOfWeek = 1 | 2 | 3 | 4 | 5 | 6 | 7;

export const DAY_NAMES: Record<DayOfWeek, string> = {
  1: 'Monday',
  2: 'Tuesday',
  3: 'Wednesday',
  4: 'Thursday',
  5: 'Friday',
  6: 'Saturday',
  7: 'Sunday',
};

export const DAY_ABBREVIATIONS: Record<DayOfWeek, string> = {
  1: 'Mon',
  2: 'Tue',
  3: 'Wed',
  4: 'Thu',
  5: 'Fri',
  6: 'Sat',
  7: 'Sun',
};
```

2. Update WeeklyMealEntry interface (around line ~83) to add optional day field:
```typescript
export interface WeeklyMealEntry {
  mealId: string;
  servings: number;
  day?: DayOfWeek;  // Optional day assignment for week view
}
```

3. Update WeeklySnackEntry interface (around line ~89) to add optional day field:
```typescript
export interface WeeklySnackEntry {
  snackId: string;
  qty: number;
  day?: DayOfWeek;  // Optional day assignment for week view
}
```

The day field is optional to maintain backward compatibility with existing data.
  </action>
  <verify>
Run `npx tsc --noEmit` - should pass with no errors
  </verify>
  <done>
DayOfWeek type exported, DAY_NAMES and DAY_ABBREVIATIONS constants available, entry interfaces have optional day field
  </done>
</task>

<task type="auto">
  <name>Task 2: Add updateMealDay and updateSnackDay functions to hook</name>
  <files>src/hooks/useWeeklyPlan.ts</files>
  <action>
Update src/hooks/useWeeklyPlan.ts:

1. Import DayOfWeek from types (update import at top):
```typescript
import type { WeeklyMeal, WeeklyMealEntry, WeeklySnackEntry, DayOfWeek } from '../types';
```

2. Add to UseWeeklyPlanReturn interface (around line ~24):
```typescript
updateMealDay: (mealId: string, day: DayOfWeek | undefined) => Promise<void>;
updateSnackDay: (snackId: string, day: DayOfWeek | undefined) => Promise<void>;
```

3. Add updateMealDay function (after updateServings, around line ~205):
```typescript
const updateMealDay = useCallback(
  async (mealId: string, day: DayOfWeek | undefined): Promise<void> => {
    if (!householdCode) {
      throw new Error('No household code available');
    }

    if (!currentWeek) {
      throw new Error('No weekly plan exists');
    }

    try {
      const docId = `${householdCode}_${weekId}`;
      const weekRef = doc(db, 'weeklyMeals', docId);

      const updatedMeals = currentWeek.meals.map((m) =>
        m.mealId === mealId ? { ...m, day } : m
      );
      await updateDoc(weekRef, { meals: updatedMeals });
    } catch (err) {
      const message = err instanceof Error ? err.message : 'Failed to update meal day';
      setError(message);
      throw err;
    }
  },
  [householdCode, weekId, currentWeek]
);
```

4. Add updateSnackDay function (after updateSnackQty, around line ~349):
```typescript
const updateSnackDay = useCallback(
  async (snackId: string, day: DayOfWeek | undefined): Promise<void> => {
    if (!householdCode) {
      throw new Error('No household code available');
    }

    if (!currentWeek) {
      throw new Error('No weekly plan exists');
    }

    try {
      const docId = `${householdCode}_${weekId}`;
      const weekRef = doc(db, 'weeklyMeals', docId);

      const currentSnacks = currentWeek.snacks ?? [];
      const updatedSnacks = currentSnacks.map((s) =>
        s.snackId === snackId ? { ...s, day } : s
      );
      await updateDoc(weekRef, { snacks: updatedSnacks });
    } catch (err) {
      const message = err instanceof Error ? err.message : 'Failed to update snack day';
      setError(message);
      throw err;
    }
  },
  [householdCode, weekId, currentWeek]
);
```

5. Add the new functions to the return object (around line ~363):
```typescript
return {
  currentWeek,
  loading,
  error,
  weekId,
  addMealToWeek,
  removeMealFromWeek,
  updateServings,
  toggleAlreadyHave,
  addSnackToWeek,
  removeSnackFromWeek,
  updateSnackQty,
  updateMealDay,    // NEW
  updateSnackDay,   // NEW
};
```
  </action>
  <verify>
Run `npx tsc --noEmit` - should pass with no errors
  </verify>
  <done>
useWeeklyPlan hook exports updateMealDay and updateSnackDay functions that persist day assignments to Firestore
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- DayOfWeek type can be imported from types
- DAY_NAMES and DAY_ABBREVIATIONS constants accessible
- useWeeklyPlan returns updateMealDay and updateSnackDay functions
</verification>

<success_criteria>
- Types compile without errors
- New type exports are available for import
- Hook functions ready for use by Week View components
</success_criteria>

<output>
After completion, create `.planning/phases/31-home-page-enhancement/31-01-SUMMARY.md`
</output>
