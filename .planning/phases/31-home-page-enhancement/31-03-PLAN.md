---
phase: 31-home-page-enhancement
plan: 03
type: execute
wave: 3
depends_on: ["31-02"]
files_modified:
  - src/components/planning/WeekView.tsx
  - src/components/planning/DayColumn.tsx
  - src/components/planning/UnassignedSection.tsx
  - src/pages/Home.tsx
autonomous: true

must_haves:
  truths:
    - "User can toggle between list view and week view"
    - "Week view shows 7 day columns"
    - "Unassigned items show in separate section"
    - "Meals and snacks display in correct day columns"
    - "Mobile shows stacked cards instead of columns"
  artifacts:
    - path: "src/components/planning/WeekView.tsx"
      provides: "7-day grid container component"
      min_lines: 50
    - path: "src/components/planning/DayColumn.tsx"
      provides: "Single day column component"
      min_lines: 40
    - path: "src/components/planning/UnassignedSection.tsx"
      provides: "Section for items without day assignment"
      min_lines: 30
    - path: "src/pages/Home.tsx"
      provides: "Conditional view rendering based on viewMode"
      contains: "viewMode === 'week'"
  key_links:
    - from: "src/pages/Home.tsx"
      to: "src/components/planning/WeekView.tsx"
      via: "conditional rendering based on viewMode"
      pattern: "viewMode === 'week'.*WeekView"
    - from: "src/components/planning/WeekView.tsx"
      to: "src/components/planning/DayColumn.tsx"
      via: "renders 7 DayColumns"
      pattern: "DayColumn"
---

<objective>
Create static week view with 7-day grid layout.

Purpose: Display meals and snacks organized by day of week, preparing for drag-and-drop in next plan.

Output: WeekView, DayColumn, and UnassignedSection components with conditional rendering in Home.tsx.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/31-home-page-enhancement/CONTEXT.md

@src/pages/Home.tsx
@src/types/index.ts
@src/components/planning/WeeklyMealCard.tsx
@src/components/planning/WeeklySnackCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DayColumn component</name>
  <files>src/components/planning/DayColumn.tsx</files>
  <action>
Create src/components/planning/DayColumn.tsx:

```tsx
import type { DayOfWeek, WeeklyMealEntry, WeeklySnackEntry, Meal, Snack } from '../../types';
import { DAY_NAMES, DAY_ABBREVIATIONS } from '../../types';

interface DayColumnProps {
  day: DayOfWeek;
  meals: WeeklyMealEntry[];
  snacks: WeeklySnackEntry[];
  getMealById: (mealId: string) => Meal | null;
  getSnackById: (snackId: string) => Snack | null;
  isToday?: boolean;
}

export function DayColumn({
  day,
  meals,
  snacks,
  getMealById,
  getSnackById,
  isToday = false,
}: DayColumnProps) {
  const dayName = DAY_NAMES[day];
  const dayAbbr = DAY_ABBREVIATIONS[day];
  const totalItems = meals.length + snacks.length;

  return (
    <div
      className={`
        flex flex-col rounded-soft border min-h-[200px]
        ${isToday
          ? 'border-terracotta/40 bg-terracotta/5'
          : 'border-charcoal/10 bg-white/50'
        }
      `}
    >
      {/* Day Header */}
      <div
        className={`
          px-3 py-2 border-b text-center
          ${isToday
            ? 'border-terracotta/20 bg-terracotta/10'
            : 'border-charcoal/5 bg-charcoal/5'
          }
        `}
      >
        <div className="hidden md:block font-medium text-charcoal text-sm">
          {dayName}
        </div>
        <div className="md:hidden font-medium text-charcoal text-sm">
          {dayAbbr}
        </div>
        {totalItems > 0 && (
          <div className="text-xs text-charcoal/50">{totalItems} item{totalItems !== 1 ? 's' : ''}</div>
        )}
      </div>

      {/* Content Area */}
      <div className="flex-1 p-2 space-y-2">
        {/* Meals */}
        {meals.map((entry) => {
          const meal = getMealById(entry.mealId);
          if (!meal) return null;

          return (
            <div
              key={entry.mealId}
              className="p-2 bg-white rounded-soft shadow-soft text-sm"
            >
              <div className="flex items-center gap-2">
                {meal.imageUrl ? (
                  <img
                    src={meal.imageUrl}
                    alt=""
                    className="w-8 h-8 rounded-soft object-cover flex-shrink-0"
                  />
                ) : (
                  <div className="w-8 h-8 rounded-soft bg-terracotta/10 flex items-center justify-center flex-shrink-0">
                    <span className="text-sm">üçΩÔ∏è</span>
                  </div>
                )}
                <div className="flex-1 min-w-0">
                  <div className="font-medium text-charcoal truncate">{meal.name}</div>
                  <div className="text-xs text-charcoal/50">{entry.servings} serving{entry.servings !== 1 ? 's' : ''}</div>
                </div>
              </div>
            </div>
          );
        })}

        {/* Snacks */}
        {snacks.map((entry) => {
          const snack = getSnackById(entry.snackId);
          if (!snack) return null;

          return (
            <div
              key={entry.snackId}
              className="p-2 bg-sage/10 rounded-soft text-sm"
            >
              <div className="flex items-center gap-2">
                {snack.imageUrl ? (
                  <img
                    src={snack.imageUrl}
                    alt=""
                    className="w-8 h-8 rounded-soft object-cover flex-shrink-0"
                  />
                ) : (
                  <div className="w-8 h-8 rounded-soft bg-sage/20 flex items-center justify-center flex-shrink-0">
                    <span className="text-sm">üçø</span>
                  </div>
                )}
                <div className="flex-1 min-w-0">
                  <div className="font-medium text-charcoal truncate">{snack.name}</div>
                  <div className="text-xs text-charcoal/50">√ó{entry.qty}</div>
                </div>
              </div>
            </div>
          );
        })}

        {/* Empty State */}
        {totalItems === 0 && (
          <div className="flex-1 flex items-center justify-center py-4">
            <span className="text-xs text-charcoal/30">No items</span>
          </div>
        )}
      </div>
    </div>
  );
}
```

This component:
- Shows day name (full on desktop, abbreviated on mobile)
- Renders meals with image/icon, name, servings
- Renders snacks with image/icon, name, quantity
- Highlights today's column with terracotta border
- Has min-height for consistent layout
  </action>
  <verify>
`npx tsc --noEmit` passes
  </verify>
  <done>
DayColumn component created with day header, meal/snack cards, and empty state
  </done>
</task>

<task type="auto">
  <name>Task 2: Create UnassignedSection and WeekView components</name>
  <files>src/components/planning/UnassignedSection.tsx, src/components/planning/WeekView.tsx</files>
  <action>
First, create src/components/planning/UnassignedSection.tsx:

```tsx
import type { WeeklyMealEntry, WeeklySnackEntry, Meal, Snack } from '../../types';

interface UnassignedSectionProps {
  meals: WeeklyMealEntry[];
  snacks: WeeklySnackEntry[];
  getMealById: (mealId: string) => Meal | null;
  getSnackById: (snackId: string) => Snack | null;
}

export function UnassignedSection({
  meals,
  snacks,
  getMealById,
  getSnackById,
}: UnassignedSectionProps) {
  const totalItems = meals.length + snacks.length;

  if (totalItems === 0) return null;

  return (
    <div className="mb-4">
      <div className="flex items-center gap-2 mb-2">
        <span className="text-sm font-medium text-charcoal/60">Unassigned</span>
        <span className="text-xs text-charcoal/40">({totalItems})</span>
      </div>

      <div className="flex flex-wrap gap-2">
        {/* Meals */}
        {meals.map((entry) => {
          const meal = getMealById(entry.mealId);
          if (!meal) return null;

          return (
            <div
              key={entry.mealId}
              className="flex items-center gap-2 px-3 py-2 bg-white rounded-soft shadow-soft"
            >
              {meal.imageUrl ? (
                <img
                  src={meal.imageUrl}
                  alt=""
                  className="w-8 h-8 rounded-soft object-cover"
                />
              ) : (
                <div className="w-8 h-8 rounded-soft bg-terracotta/10 flex items-center justify-center">
                  <span className="text-sm">üçΩÔ∏è</span>
                </div>
              )}
              <div>
                <div className="font-medium text-charcoal text-sm">{meal.name}</div>
                <div className="text-xs text-charcoal/50">{entry.servings} serving{entry.servings !== 1 ? 's' : ''}</div>
              </div>
            </div>
          );
        })}

        {/* Snacks */}
        {snacks.map((entry) => {
          const snack = getSnackById(entry.snackId);
          if (!snack) return null;

          return (
            <div
              key={entry.snackId}
              className="flex items-center gap-2 px-3 py-2 bg-sage/10 rounded-soft"
            >
              {snack.imageUrl ? (
                <img
                  src={snack.imageUrl}
                  alt=""
                  className="w-8 h-8 rounded-soft object-cover"
                />
              ) : (
                <div className="w-8 h-8 rounded-soft bg-sage/20 flex items-center justify-center">
                  <span className="text-sm">üçø</span>
                </div>
              )}
              <div>
                <div className="font-medium text-charcoal text-sm">{snack.name}</div>
                <div className="text-xs text-charcoal/50">√ó{entry.qty}</div>
              </div>
            </div>
          );
        })}
      </div>

      <p className="text-xs text-charcoal/40 mt-2">
        Drag items to a day to schedule them
      </p>
    </div>
  );
}
```

Then, create src/components/planning/WeekView.tsx:

```tsx
import { useMemo } from 'react';
import type { DayOfWeek, WeeklyMealEntry, WeeklySnackEntry, Meal, Snack } from '../../types';
import { DayColumn } from './DayColumn';
import { UnassignedSection } from './UnassignedSection';

interface WeekViewProps {
  meals: WeeklyMealEntry[];
  snacks: WeeklySnackEntry[];
  getMealById: (mealId: string) => Meal | null;
  getSnackById: (snackId: string) => Snack | null;
}

// Get current day of week (1=Monday, 7=Sunday)
function getCurrentDayOfWeek(): DayOfWeek {
  const jsDay = new Date().getDay(); // 0=Sunday, 6=Saturday
  // Convert to ISO (1=Monday, 7=Sunday)
  return (jsDay === 0 ? 7 : jsDay) as DayOfWeek;
}

export function WeekView({ meals, snacks, getMealById, getSnackById }: WeekViewProps) {
  const today = useMemo(() => getCurrentDayOfWeek(), []);

  // Group meals by day
  const mealsByDay = useMemo(() => {
    const grouped: Record<DayOfWeek | 'unassigned', WeeklyMealEntry[]> = {
      1: [], 2: [], 3: [], 4: [], 5: [], 6: [], 7: [],
      unassigned: [],
    };

    for (const entry of meals) {
      if (entry.day) {
        grouped[entry.day].push(entry);
      } else {
        grouped.unassigned.push(entry);
      }
    }

    return grouped;
  }, [meals]);

  // Group snacks by day
  const snacksByDay = useMemo(() => {
    const grouped: Record<DayOfWeek | 'unassigned', WeeklySnackEntry[]> = {
      1: [], 2: [], 3: [], 4: [], 5: [], 6: [], 7: [],
      unassigned: [],
    };

    for (const entry of snacks) {
      if (entry.day) {
        grouped[entry.day].push(entry);
      } else {
        grouped.unassigned.push(entry);
      }
    }

    return grouped;
  }, [snacks]);

  const days: DayOfWeek[] = [1, 2, 3, 4, 5, 6, 7];

  return (
    <div className="space-y-4">
      {/* Unassigned Section */}
      <UnassignedSection
        meals={mealsByDay.unassigned}
        snacks={snacksByDay.unassigned}
        getMealById={getMealById}
        getSnackById={getSnackById}
      />

      {/* Week Grid - 7 columns on desktop, stacked on mobile */}
      <div className="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-7 gap-2">
        {days.map((day) => (
          <DayColumn
            key={day}
            day={day}
            meals={mealsByDay[day]}
            snacks={snacksByDay[day]}
            getMealById={getMealById}
            getSnackById={getSnackById}
            isToday={day === today}
          />
        ))}
      </div>
    </div>
  );
}
```

This WeekView component:
- Groups meals/snacks by their day field (unassigned if no day)
- Shows UnassignedSection at top with horizontal card layout
- Renders 7 DayColumns in a responsive grid (2 cols mobile, 4 tablet, 7 desktop)
- Highlights today's column
  </action>
  <verify>
`npx tsc --noEmit` passes
  </verify>
  <done>
WeekView and UnassignedSection components created with day grouping and responsive grid layout
  </done>
</task>

<task type="auto">
  <name>Task 3: Add conditional view rendering to Home.tsx</name>
  <files>src/pages/Home.tsx</files>
  <action>
Update src/pages/Home.tsx to conditionally render list view or week view:

1. Add import for WeekView (add to imports at top):
```tsx
import { WeekView } from '../components/planning/WeekView';
```

2. Find the main content area (the conditional `{!hasContent ? ... : ...}` block around line 246).
Replace the entire content section to include both views:

```tsx
<div className="px-4">
  {!hasContent ? (
    <EmptyWeeklyPlan onAdd={() => setIsLoadMealsModalOpen(true)} />
  ) : viewMode === 'list' ? (
    /* List View (existing) */
    <div className="space-y-6">
      {/* Meals Section */}
      {weeklyMeals.length > 0 && (
        <div>
          <h2 className="text-sm font-medium text-charcoal/60 mb-3 flex items-center gap-2">
            <span>üçΩÔ∏è</span> Meals ({weeklyMeals.length})
          </h2>
          <div className="grid grid-cols-1 gap-4">
            {weeklyMeals.map((entry, index) => (
              <div
                key={entry.mealId}
                className="animate-fade-in-up"
                style={{ animationDelay: `${index * 50}ms` }}
              >
                <WeeklyMealCard
                  entry={entry}
                  meal={getMealById(entry.mealId)}
                  alreadyHave={alreadyHave}
                  onEditServings={handleEditServings}
                  onRemove={handleRemove}
                  onToggleAlreadyHave={toggleAlreadyHave}
                />
              </div>
            ))}
          </div>
        </div>
      )}

      {/* Snacks Section */}
      {weeklySnacks.length > 0 && (
        <div>
          <h2 className="text-sm font-medium text-charcoal/60 mb-3 flex items-center gap-2">
            <span>üçø</span> Snacks ({weeklySnacks.length})
          </h2>
          <div className="grid grid-cols-1 gap-3">
            {weeklySnacks.map((entry, index) => (
              <div
                key={entry.snackId}
                className="animate-fade-in-up"
                style={{ animationDelay: `${(weeklyMeals.length + index) * 50}ms` }}
              >
                <WeeklySnackCard
                  entry={entry}
                  snack={getSnackById(entry.snackId)}
                  onEditQty={handleEditSnackQty}
                  onRemove={handleRemoveSnack}
                />
              </div>
            ))}
          </div>
        </div>
      )}
    </div>
  ) : (
    /* Week View */
    <WeekView
      meals={weeklyMeals}
      snacks={weeklySnacks}
      getMealById={getMealById}
      getSnackById={getSnackById}
    />
  )}

  {/* Quick Add Buttons - always visible when there's content or meals in library */}
  {(hasContent || meals.length > 0) && (
    <div className="flex gap-3 mt-6">
      <button
        onClick={() => setIsLoadMealsModalOpen(true)}
        className="flex-1 py-3 border-2 border-dashed border-terracotta/40 rounded-soft text-terracotta hover:border-terracotta hover:bg-terracotta/5 transition-colors flex items-center justify-center gap-2"
      >
        <span>üçΩÔ∏è</span>
        <span>Meals</span>
      </button>
      {snacks.length > 0 && (
        <button
          onClick={handleAddSnackClick}
          className="flex-1 py-3 border-2 border-dashed border-sage/40 rounded-soft text-sage hover:border-sage hover:bg-sage/5 transition-colors flex items-center justify-center gap-2"
        >
          <span>üçø</span>
          <span>Snacks</span>
        </button>
      )}
    </div>
  )}
</div>
```

3. Update the EmptyWeeklyPlan onAdd to use the LoadMealsModal instead of the old AddToWeekModal:
```tsx
<EmptyWeeklyPlan onAdd={() => setIsLoadMealsModalOpen(true)} />
```

Note: The Quick Add Buttons may have been added in Plan 02. If so, ensure they're placed correctly outside the view conditional but inside the px-4 wrapper.
  </action>
  <verify>
- `npx tsc --noEmit` passes
- `npm run dev` and verify:
  - Toggle in header switches between list and week view
  - Week view shows 7 columns (responsive)
  - Items without day show in Unassigned section
  - Today's column is highlighted
  </verify>
  <done>
Home.tsx renders list view or week view based on toggle state, week view shows day columns and unassigned section
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- Run dev server and test:
  - Click toggle to switch between list and week view
  - Week view shows 7 day columns
  - Unassigned section shows items without day
  - Today's column highlighted with terracotta
  - Responsive: 2 cols on mobile, 7 on desktop
  - List view still works as before
</verification>

<success_criteria>
- DayColumn shows day name, meals, snacks, empty state
- UnassignedSection shows items without day assignment
- WeekView renders responsive 7-day grid
- Toggle in header switches between views
- Today's column visually distinct
</success_criteria>

<output>
After completion, create `.planning/phases/31-home-page-enhancement/31-03-SUMMARY.md`
</output>
